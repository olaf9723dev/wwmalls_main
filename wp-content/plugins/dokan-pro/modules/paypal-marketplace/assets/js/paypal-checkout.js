!function(e,r,o){"use strict";if("undefined"==typeof dokan_paypal||!dokan_paypal.is_checkout_page)return;if("smart"!==dokan_paypal.payment_button_type)return;const t={checkout_form:e("form.checkout, form#order_review"),order_success_redirect_url:"",order_cancel_redirect_url:"",selected_payment_method:"",order_id:"",loaded:!1,toggle_buttons:function(r){let o="dokan_paypal_marketplace"===r,t=o?"show":"hide",a=o?"hide":"show";e("#paypal-button-container").animate({opacity:t,height:t,padding:t},230),e("#place_order").animate({opacity:a,height:a,padding:a},230)},on_change:function(){e("form.checkout, form#order_review").on("click",'input[name="payment_method"]',(function(e){"smart"===dokan_paypal.payment_button_type&&t.selected_payment_method!==e.target.value&&(t.selected_payment_method=e.target.value,t.toggle_buttons(e.target.value))}))},reset_order_data:function(){this.order_success_redirect_url="",this.order_cancel_redirect_url="",this.order_id=""},is_paypal_selected:function(){return"dokan_paypal_marketplace"===e(".woocommerce-checkout").find('input[name="payment_method"]:checked').val()},set_loading_on:function(){t.checkout_form.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},set_loading_done:function(){t.checkout_form.removeClass("processing").unblock()},submit_error:function(r){t.set_loading_done(),t.reset_order_data(),e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),t.checkout_form.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+r+"</div>"),t.checkout_form.find(".input-text, select, input:checkbox").trigger("validate").trigger("blur"),t.scroll_to_notice(),e(o.body).trigger("checkout_error",[r])},scroll_to_notice:function(){e("html, body").animate({scrollTop:e("form.checkout, form#order_review").offset().top-100},1e3)},set_order:function(){return e.ajax({type:"POST",url:wc_checkout_params.checkout_url,data:t.checkout_form.serialize(),dataType:"json"}).fail((function(e,r,o){t.submit_error('<div class="woocommerce-error">'+o+"</div>")}))},create_order:function(){t.set_loading_on();let r={order_id:dokan_paypal.order_id,action:"dokan_paypal_create_order",nonce:dokan_paypal.nonce};return e.ajax({type:"POST",url:dokan_paypal.ajaxurl,data:r,dataType:"json"}).fail((function(e,r,o){t.set_loading_done(),t.submit_error('<div class="woocommerce-error">'+o+"</div>")}))},do_submit:function(){return t.set_loading_on(),dokan_paypal.is_checkout_pay_page?t.create_order():t.set_order()},capture_payment:function(o,a,c=!1){t.set_loading_on();let n={order_id:o,action:"dokan_paypal_capture_payment",nonce:dokan_paypal.nonce};e.ajax({type:"POST",url:dokan_paypal.ajaxurl,data:n,dataType:"json"}).done((function(e){t.set_loading_done();try{if(!e.success){if(e.data.message.details){if("INSTRUMENT_DECLINED"===e.data.message.details[0].issue)return c.restart();let r=e.data.message.details[0].description?e.data.message.details[0].description:e.data.message.message;throw new Error(r)}throw new Error(e.data.message)}r.location.href=a}catch(o){if(!0===e.reload)return void r.location.reload();e.data.message&&t.submit_error('<div class="woocommerce-error">'+e.data.message+"</div>")}})).fail((function(e,r,o){t.set_loading_done(),t.submit_error('<div class="woocommerce-error">'+o+"</div>")}))},render_ajax_response:function(e){try{if(dokan_paypal.is_checkout_pay_page&&(e=e.data.data),t.set_loading_done(),"success"===e.result)return t.order_success_redirect_url=e.success_redirect,t.order_cancel_redirect_url=e.cancel_redirect,t.order_id=e.id,e.paypal_order_id;throw"failure"===e.result?new Error("Result failure"):new Error("Invalid response")}catch(a){return!0===e.reload&&r.location.reload(),!0===e.refresh&&jQuery(o.body).trigger("update_checkout"),e.messages?t.submit_error(e.messages):t.submit_error('<div class="woocommerce-error">'+wc_checkout_params.i18n_checkout_error+"</div>"),!1}},init_hosted_fields:function(){dokan_paypal.is_ucc_enabled&&r.paypal.HostedFields.isEligible()&&r.paypal.HostedFields.render({createOrder:function(){return!!t.is_paypal_selected()&&t.do_submit().then((function(e){return t.render_ajax_response(e)}))},styles:{input:{"font-size":"17px","font-family":"helvetica, tahoma, calibri, sans-serif",color:"#3a3a3a"},":focus":{color:"black"}},fields:{number:{selector:"#dpm_card_number",placeholder:dokan_paypal.ucc_fields_placeholder.card_number},cvv:{selector:"#dpm_cvv",placeholder:dokan_paypal.ucc_fields_placeholder.cvv_number},expirationDate:{selector:"#dpm_card_expiry",placeholder:dokan_paypal.ucc_fields_placeholder.expiry_date}}}).then((function(r){let a;r.on("validityChange",(function(o){o.fields[o.emittedBy];let t=r.getState();a=Object.keys(t.fields).every((function(e){return t.fields[e].isValid?t.fields[e].container.style.boxShadow="inset 2px 0 0 #0f834d":t.fields[e].container.style.boxShadow="inset 2px 0 0 #cc0000",t.fields[e].isValid})),a?e("#pay_unbranded_order").attr("disabled",!1):e("#pay_unbranded_order").attr("disabled",!0)})),e("#pay_unbranded_order").on("click",(function(c){if(c.preventDefault(),e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),!a)return t.submit_error('<div class="woocommerce-error">'+dokan_paypal.card_info_error_message+"</div>"),!1;let n={};n=dokan_paypal.billing_address?dokan_paypal.billing_address:{streetAddress:o.getElementById("billing_address_1").value,extendedAddress:o.getElementById("billing_address_2").value,region:o.getElementById("billing_state").value,locality:o.getElementById("billing_city").value,postalCode:o.getElementById("billing_postcode").value,countryCodeAlpha2:o.getElementById("billing_country").value};let d={contingencies:["3D_SECURE"],cardholderName:o.getElementById("dpm_name_on_card").value,billingAddress:n};r.submit(d).then((function(e){t.capture_payment(t.order_id,t.order_success_redirect_url)})).catch((function(e){t.submit_error('<div class="woocommerce-error">'+e.message+"</div>")}))}))})).catch((function(e){t.submit_error('<div class="woocommerce-error">'+e.message+"</div>")}))},init_paypal:function(){if(r.paypal&&r.paypal.Buttons&&!t.loaded){t.loaded=!0,r.paypal.Buttons({createOrder:function(e,r){return!!t.is_paypal_selected()&&t.do_submit().then((function(e){return t.render_ajax_response(e)}))},onApprove:function(e,r){t.capture_payment(t.order_id,t.order_success_redirect_url,r)},onCancel:function(e){t.set_loading_done(),t.reset_order_data()},onError:function(e){t.set_loading_done(),0===t.checkout_form.find(".woocommerce-NoticeGroup > ul.woocommerce-error, .woocommerce-NoticeGroup-checkout > ul.woocommerce-error").length&&t.submit_error('<div class="woocommerce-error">'+e+"</div>")}}).render("#paypal-button-container").catch((function(e){t.submit_error('<div class="woocommerce-error">'+JSON.stringify(e)+"</div>")})),t.init_hosted_fields();let o=e(".woocommerce-checkout").find('input[name="payment_method"]:checked').val();t.toggle_buttons(o),t.on_change(),e(".paypal-loader").hide()}else t.loaded||setTimeout((()=>{t.init_paypal()}),1e3)}};e(o).ready((function(){setTimeout((()=>{t.init_paypal()}),5e3)}))}(jQuery,window,document);